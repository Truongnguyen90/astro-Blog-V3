---
// Fundations
import Text from "@/components/fundations/elements/Text.astro";
import Wrapper from "@/components/fundations/containers/Wrapper.astro";
// Icons
import Burger from "@/components/fundations/icons/Burger.astro";
import Plus from "@/components/fundations/icons/Plus.astro";

// Navigation links
const navLinks = [
  {
    text: "Blog",
    href: "/blog/",
  },
  {
    text: "Projects",
    href: "/projects/",
  },
  {
    text: "Work",
    href: "/work/",
  },
  {
    text: "Tools",
    href: "/stack",
  },
  {
    text: "Now",
    href: "/now",
  },
  {
    text: "Contact",
    href: "/forms/contact",
  },
];
---

<header>
  <Wrapper variant="standard">
    <nav
      role="navigation"
      class="items-center w-full py-4 grid grid-cols-2 gap-4"
    >
      <div class="flex items-center gap-2">
        <Text
          tag="a"
          variant="textXL"
          href="/"
          aria-label="Go to homepage"
          class="italic text-center font-display text-base-900 dark:text-white"
        >
          Truong Nguyen
        </Text>
      </div>
      <div class="flex items-center justify-end gap-2">
        <div class="flex items-center gap-2">
          <a
            class="text-sm text-base-500 hover:text-base-900 duration-300 dark:text-base-400 dark:hover:text-white"
            href="/socials"
          >
            Social
          </a>
          <a
            class="text-sm text-base-500 hover:text-base-900 duration-300 dark:text-base-400 dark:hover:text-white"
            href="/studio"
          >
            Studio
          </a>
        </div>
        <!-- Always show menu toggle -->
        <button
          type="button"
          id="menuToggle"
          aria-controls="menu"
          aria-expanded="false"
          aria-label="Open menu"
          class="focus-visible:outline-none"
        >
          <span class="sr-only">Toggle menu</span>
          <Burger class="size-5 shrink-0 dark:text-white" />
        </button>
        <div
          id="menuContent"
          class="fixed inset-0 z-50 opacity-0 pointer-events-none transition-opacity duration-300 ease-in-out bg-white/20 dark:bg-black/50 backdrop-blur-xl"
        >
          <Wrapper variant="standard" class="relative h-full px-8 py-4">
            <button
              id="closeMenu"
              aria-label="Close menu"
              class="flex ml-auto text-base-900 dark:text-white"
            >
              <Plus
                class="transition duration-300 ease-in-out size-5 shrink-0 stroke-base-950 dark:stroke-white"
              />
            </button>
            <nav role="navigation" class="flex flex-col mt-4 gap-y-2">
              {
                navLinks.map((link) => (
                  <div class="flex justify-end">
                    <Text
                      tag="a"
                      variant="textXL"
                      underlined={true}
                      href={link.href}
                      title={link.text}
                      aria-label={link.text}
                      class="block text-right dark:text-white text-base-900"
                    >
                      {link.text}
                    </Text>
                  </div>
                ))
              }
              <!-- Add mobile-only menu items for the hidden elements -->
              <div class="flex justify-end md:hidden">
                <Text
                  tag="a"
                  variant="textXL"
                  underlined={true}
                  href="/socials"
                  title="Social"
                  aria-label="Social"
                  class="block text-right dark:text-white text-base-900"
                >
                  Social
                </Text>
              </div>
              <div class="flex justify-end md:hidden">
                <Text
                  tag="a"
                  variant="textXL"
                  underlined={true}
                  href="/studio"
                  title="Studio"
                  aria-label="Studio"
                  class="block text-right dark:text-white text-base-900"
                >
                  Studio
                </Text>
              </div>
            </nav>
          </Wrapper>
        </div>
      </div>
    </nav>
  </Wrapper>
</header>

<script type="module">
  // Wait for the DOM content to fully load before executing the script
  document.addEventListener("DOMContentLoaded", (event) => {
    // Get references to the menu toggle button, menu content, and close button
    const menuToggle = document.getElementById("menuToggle");
    const menuContent = document.getElementById("menuContent");
    const closeMenu = document.getElementById("closeMenu");
    // Function to toggle the visibility of the menu
    function toggleMenu() {
      // Check if the menu is currently closed (based on the presence of a specific class)
      const isOpening = menuContent.classList.contains("opacity-0");
      // Toggle classes to show/hide the menu
      menuContent.classList.toggle("opacity-0"); // Controls the opacity of the menu
      menuContent.classList.toggle("pointer-events-none"); // Toggles pointer event handling for the menu
      document.body.classList.toggle("overflow-hidden-no-shift"); // Toggles overflow behavior for the body element
      // If the menu is opening, reset and animate its links
      if (isOpening) {
        setTimeout(() => resetAndAnimateLinks(), 10); // Delay to ensure animations are applied correctly
      }
    }
    // Function to reset and apply animations to the navigation links
    function resetAndAnimateLinks() {
      // Select all anchor links inside the navigation
      const navLinks = document.querySelectorAll("nav a");
      // Loop through each link to reset its styles and apply animations
      navLinks.forEach((link, index) => {
        // Reset the opacity and position of each link to an initial state
        link.style.opacity = "0";
        link.style.transform = "translateY(20px)";
        link.style.transition = "none"; // Remove any pre-existing transitions
        // Apply a delayed animation to each link
        setTimeout(() => {
          // Set transition styles for opacity and position, with a delay based on the index
          link.style.transition = `opacity 0.3s ease-out ${index * 0.1}s, transform 0.3s ease-out ${index * 0.1}s`;
          link.style.opacity = "1"; // Fade the link in
          link.style.transform = "translateY(0)"; // Move the link back to its original position
        }, 50);
      });
    }
    // Attach the toggleMenu function to the menu toggle button's click event
    menuToggle.addEventListener("click", toggleMenu);
    // Attach the toggleMenu function to the close button's click event
    closeMenu.addEventListener("click", toggleMenu);
  });
</script>
